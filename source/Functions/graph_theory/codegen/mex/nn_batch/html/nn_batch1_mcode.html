<!-- saved from url=(0014)about:internet -->
<html>
<body>
<script src="resources/eml_report_loadable_data.js"></script>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">neighbors</span>,<span class="var type1" id="S3T1U4">distances</span>] = nn_batch( <span class="var type1" id="S4T1U7">X</span>,<span class="var type1" id="S5T1U8">Y</span>,<span class="var type1" id="S6T2U9">k</span> )</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"><span class="mxinfo " id="T2:U6">[<span class="var type1" id="S7T2U13">n</span>,<span class="mxinfo " id="T2:U8">~</span>] = size( <span class="var type1" id="S4T1U17">X</span> )</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line"><span class="mxinfo " id="T2:U10">[<span class="var type1" id="S9T2U21">m</span>,<span class="mxinfo " id="T2:U12">~</span>] = size( <span class="var type1" id="S5T1U25">Y</span> )</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T3:U14">any( <span class="mxinfo " id="T4:U15"><span class="var type1" id="S6T2U31">k</span> &gt; <span class="mxinfo " id="T5:U17">[<span class="var type1" id="S7T2U34">n</span>,<span class="var type1" id="S9T2U35">m</span>]</span></span> )</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line">    error( <span class="string">'requested more neighbors than number of points'</span> );</span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">% calculate the ranges for looping</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line"><span class="mxinfo " id="T1:U20"><span class="var type1" id="S2T1U42">neighbors</span> = <span class="mxinfo " id="T1:U22">zeros( <span class="var type1" id="S7T2U45">n</span>,<span class="var type1" id="S6T2U46">k</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line"><span class="mxinfo " id="T1:U25"><span class="var type1" id="S3T1U49">distances</span> = <span class="mxinfo " id="T1:U27">zeros(<span class="var type1" id="S7T2U52">n</span>,<span class="var type1" id="S6T2U53">k</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line">[<span class="var type1" id="S13T6U57">start</span>,<span class="var type1" id="S14T6U58">stop</span>] = <span class="fcn" id="F85N4:B60">find_blockIndex_range</span>( <span class="var type1" id="S9T2U61">m</span>,<span class="var type1" id="S7T2U62">n</span> );</span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S16T2U65">i</span> = <span class="mxinfo " id="T2:U35">1</span>:<span class="mxinfo " id="T2:U36">numel( <span class="var type1" id="S13T6U70">start</span> )</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line">    <span class="comment">% euclidean distance</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line">    <span class="mxinfo " id="T1:U38"><span class="var type1" id="S18T1U73">pts</span> = <span class="mxinfo " id="T1:U40"><span class="var type1" id="S4T1U75">X</span>(<span class="mxinfo " id="T6:U42"><span class="mxinfo " id="T2:U43"><span class="var type1" id="S13T6U78">start</span>(<span class="var type1" id="S16T2U79">i</span>)</span>:<span class="mxinfo " id="T2:U46"><span class="var type1" id="S14T6U81">stop</span>(<span class="var type1" id="S16T2U82">i</span>)</span></span>,<span class="mxinfo " id="T7:U49">:</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line">    <span class="mxinfo " id="T1:U50"><span class="var type1" id="S19T1U86">S</span> = <span class="mxinfo " id="T1:U52">sqrt( <span class="mxinfo " id="T1:U53">abs( <span class="mxinfo " id="T1:U54">bsxfun( @plus,<span class="mxinfo " id="T8:U55">dot( <span class="var type1" id="S18T1U97">pts</span>,<span class="var type1" id="S5T1U98">Y</span>,2 )</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line">                            <span class="mxinfo " id="T1:U58">bsxfun( @minus,<span class="mxinfo " id="T8:U59">dot( <span class="var type1" id="S18T1U106">pts</span>,<span class="var type1" id="S5T1U107">Y</span>,2 )</span>,<span class="mxinfo " id="T1:U62"><span class="mxinfo " id="T2:U63">2</span>*(<span class="mxinfo " id="T1:U64"><span class="var type1" id="S18T1U113">pts</span>*<span class="mxinfo " id="T1:U66"><span class="var type1" id="S5T1U115">Y</span>'</span></span>)</span> )</span> )</span> )</span> )</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line">    <span class="comment">% nearest neighbors</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line">    [<span class="mxinfo " id="T1:U68"><span class="var type1" id="S19T1U120">S</span>(:)</span>,<span class="var type1" id="S26T1U122">idx</span>] = sort( <span class="var type1" id="S19T1U125">S</span>,<span class="string">'ascend'</span> ); <span class="comment">% sorts smallest - largest columns for each row</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line">    <span class="mxinfo " id="T1:U72"><span class="mxinfo " id="T1:U73"><span class="var type1" id="S2T1U130">neighbors</span>(<span class="mxinfo " id="T6:U75"><span class="mxinfo " id="T2:U76"><span class="var type1" id="S13T6U133">start</span>(<span class="var type1" id="S16T2U134">i</span>)</span>:<span class="mxinfo " id="T2:U79"><span class="var type1" id="S14T6U136">stop</span>(<span class="var type1" id="S16T2U137">i</span>)</span></span>,<span class="mxinfo " id="T7:U82">:</span>)</span> = <span class="mxinfo " id="T1:U83"><span class="mxinfo " id="T1:U84"><span class="var type1" id="S26T1U141">idx</span>(<span class="mxinfo " id="T6:U86"><span class="mxinfo " id="T2:U87">2</span>:<span class="mxinfo " id="T2:U88"><span class="var type1" id="S6T2U145">k</span>+<span class="mxinfo " id="T2:U90">1</span></span></span>,<span class="mxinfo " id="T7:U91">:</span>)</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line">    <span class="mxinfo " id="T1:U92"><span class="mxinfo " id="T1:U93"><span class="var type1" id="S3T1U151">distances</span>(<span class="mxinfo " id="T6:U95"><span class="mxinfo " id="T2:U96"><span class="var type1" id="S13T6U154">start</span>(<span class="var type1" id="S16T2U155">i</span>)</span>:<span class="mxinfo " id="T2:U99"><span class="var type1" id="S14T6U157">stop</span>(<span class="var type1" id="S16T2U158">i</span>)</span></span>,<span class="mxinfo " id="T7:U102">:</span>)</span> = <span class="mxinfo " id="T1:U103"><span class="mxinfo " id="T1:U104"><span class="var type1" id="S19T1U162">S</span>(<span class="mxinfo " id="T6:U106"><span class="mxinfo " id="T2:U107">2</span>:<span class="mxinfo " id="T2:U108"><span class="var type1" id="S6T2U166">k</span>+<span class="mxinfo " id="T2:U110">1</span></span></span>,<span class="mxinfo " id="T7:U111">:</span>)</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
</body>
</html>
